# 外部排序

**流程：**

外部排序 $\rightarrow$ 生成初始归并段 $\rightarrow$ 第一趟归并 $\rightarrow$ 第二趟归并 $\rightarrow$

**时间开销：**

  外部排序时间开销=读写外存的时间+内部排序所需的时间+内部归并所需的时间

**重要结论：**

- 对r个初始归并段，做k路归并，则归并树可用k叉树表示。若树高为h，则归并趟数 $=h-1=\lceil \log_k{r}\rceil$
  >推导：k叉树第h层最多有 $k^{h-1}$个结点，则 $r\leq k^{h-1}$， $(h-1)_{min}=\lceil \log_k{r}\rceil$

**优化：**

1. 采用多路归并可以减少归并趟数，从而减少磁盘I/O次数 $=h-1=\lceil \log_k{r}\rceil$
    >多路归并带来的负面影响
    - k路归并时，需要开辟k个输入缓冲区，内存开销增加
    - 每挑选一个关键字需要对比关键字k-1次，内部归并所需时间增加
2. 减少初始归并段数量r

**k路平衡归并：**

1. 最多只能有k个段归并为一个
2. 每一趟归并中，若有m个归并段参与归并，则经过这一趟处理得到 $\lceil m/k\rceil$ 个新的归并段

## 败者树(k路平衡归并的改进)

1. 第一次构造败者树需要对比关键字k-1次
2. 有了败者树，选出最小元素，只需对比关键字 $\lceil \log_2{k}\rceil$ 次

## 置换——选择排序

## 最佳归并树

**重要结论：**归并过程中的磁盘I/O次数=归并树的WPL*2

### k叉最佳归并树

对于k叉归并，若初始归并段的数量无法构成严格的k叉归并树，则需要补充几个长度为0的虚段，在进行k叉哈夫曼树的构造

>k叉的最佳归并树一定是一棵严格的k叉树，即树中只包含度为k、0的结点。设度为k的结点有 $n_{k}$个，度为0的结点有 $n_{0}$个，归并树的总结点数= $n$则：初始归并段数量+虚段数量= $n_{0}$
$$n=n_{0}+n_{k} , kn_{k}=n-1\rightarrow n_{0}=(k-1)n_{k}+1\rightarrow n_{k}=\dfrac{(n_{0}-1)}{(k-1)}$$

- 补充 $k-1-(初始归并段数量-1)\% (k-1)$个虚段
